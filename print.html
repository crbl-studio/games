<!DOCTYPE HTML>
<html lang="en" class="sidebar-visible no-js rust">
    <head>
        <!-- Book generated using mdBook -->
        <meta charset="UTF-8">
        <title>CRBl_ Studio Games - Project Description and Documentation</title>
        <meta name="robots" content="noindex" />
        <!-- Custom HTML head -->
        <meta content="text/html; charset=utf-8" http-equiv="Content-Type">
        <meta name="description" content="This book covers the ins and outs of the CRBl_ Studio Games project, describing how it should be and how it works">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="theme-color" content="#ffffff" />

        <link rel="icon" href="favicon.svg">
        <link rel="shortcut icon" href="favicon.png">
        <link rel="stylesheet" href="css/variables.css">
        <link rel="stylesheet" href="css/general.css">
        <link rel="stylesheet" href="css/chrome.css">
        <link rel="stylesheet" href="css/print.css" media="print">
        <!-- Fonts -->
        <link rel="stylesheet" href="FontAwesome/css/font-awesome.css">
        <link rel="stylesheet" href="fonts/fonts.css">
        <!-- Highlight.js Stylesheets -->
        <link rel="stylesheet" href="highlight.css">
        <link rel="stylesheet" href="tomorrow-night.css">
        <link rel="stylesheet" href="ayu-highlight.css">

        <!-- Custom theme stylesheets -->
        <link rel="stylesheet" href="other/mdbook-admonish.css">
    </head>
    <body>
        <!-- Provide site root to javascript -->
        <script type="text/javascript">
            var path_to_root = "";
            var default_theme = window.matchMedia("(prefers-color-scheme: dark)").matches ? "navy" : "rust";
        </script>

        <!-- Work around some values being stored in localStorage wrapped in quotes -->
        <script type="text/javascript">
            try {
                var theme = localStorage.getItem('mdbook-theme');
                var sidebar = localStorage.getItem('mdbook-sidebar');

                if (theme.startsWith('"') && theme.endsWith('"')) {
                    localStorage.setItem('mdbook-theme', theme.slice(1, theme.length - 1));
                }

                if (sidebar.startsWith('"') && sidebar.endsWith('"')) {
                    localStorage.setItem('mdbook-sidebar', sidebar.slice(1, sidebar.length - 1));
                }
            } catch (e) { }
        </script>

        <!-- Set the theme before any content is loaded, prevents flash -->
        <script type="text/javascript">
            var theme;
            try { theme = localStorage.getItem('mdbook-theme'); } catch(e) { }
            if (theme === null || theme === undefined) { theme = default_theme; }
            var html = document.querySelector('html');
            html.classList.remove('no-js')
            html.classList.remove('rust')
            html.classList.add(theme);
            html.classList.add('js');
        </script>

        <!-- Hide / unhide sidebar before it is displayed -->
        <script type="text/javascript">
            var html = document.querySelector('html');
            var sidebar = 'hidden';
            if (document.body.clientWidth >= 1080) {
                try { sidebar = localStorage.getItem('mdbook-sidebar'); } catch(e) { }
                sidebar = sidebar || 'visible';
            }
            html.classList.remove('sidebar-visible');
            html.classList.add("sidebar-" + sidebar);
        </script>

        <nav id="sidebar" class="sidebar" aria-label="Table of contents">
            <div class="sidebar-scrollbox">
                <ol class="chapter"><li class="chapter-item expanded affix "><a href="introduction.html">Introduction</a></li><li class="spacer"></li><li class="chapter-item expanded "><a href="description.html"><strong aria-hidden="true">1.</strong> Description</a></li><li class="chapter-item expanded affix "><li class="part-title">Project components</li><li class="chapter-item expanded "><a href="architecture.html"><strong aria-hidden="true">2.</strong> General architecture</a></li><li class="chapter-item expanded "><a href="auth/index.html"><strong aria-hidden="true">3.</strong> Authentication service</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="auth/database.html"><strong aria-hidden="true">3.1.</strong> Database</a></li><li class="chapter-item expanded "><a href="auth/api.html"><strong aria-hidden="true">3.2.</strong> API</a></li></ol></li><li class="chapter-item expanded "><div><strong aria-hidden="true">4.</strong> API service</div></li><li><ol class="section"><li class="chapter-item expanded "><div><strong aria-hidden="true">4.1.</strong> API</div></li></ol></li><li class="chapter-item expanded "><div><strong aria-hidden="true">5.</strong> Game server</div></li><li><ol class="section"><li class="chapter-item expanded "><div><strong aria-hidden="true">5.1.</strong> API</div></li><li class="chapter-item expanded "><div><strong aria-hidden="true">5.2.</strong> Mini-games API</div></li></ol></li><li class="chapter-item expanded "><div><strong aria-hidden="true">6.</strong> Mini-game servers</div></li><li><ol class="section"><li class="chapter-item expanded "><div><strong aria-hidden="true">6.1.</strong> Example</div></li></ol></li></ol>
            </div>
            <div id="sidebar-resize-handle" class="sidebar-resize-handle"></div>
        </nav>

        <div id="page-wrapper" class="page-wrapper">

            <div class="page">
                <div id="menu-bar-hover-placeholder"></div>
                <div id="menu-bar" class="menu-bar sticky bordered">
                    <div class="left-buttons">
                        <button id="sidebar-toggle" class="icon-button" type="button" title="Toggle Table of Contents" aria-label="Toggle Table of Contents" aria-controls="sidebar">
                            <i class="fa fa-bars"></i>
                        </button>
                        <button id="theme-toggle" class="icon-button" type="button" title="Change theme" aria-label="Change theme" aria-haspopup="true" aria-expanded="false" aria-controls="theme-list">
                            <i class="fa fa-paint-brush"></i>
                        </button>
                        <ul id="theme-list" class="theme-popup" aria-label="Themes" role="menu">
                            <li role="none"><button role="menuitem" class="theme" id="light">Light</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="rust">Rust (default)</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="coal">Coal</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="navy">Navy</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="ayu">Ayu</button></li>
                        </ul>
                        <button id="search-toggle" class="icon-button" type="button" title="Search. (Shortkey: s)" aria-label="Toggle Searchbar" aria-expanded="false" aria-keyshortcuts="S" aria-controls="searchbar">
                            <i class="fa fa-search"></i>
                        </button>
                    </div>

                    <h1 class="menu-title">CRBl_ Studio Games - Project Description and Documentation</h1>

                    <div class="right-buttons">
                        <a href="print.html" title="Print this book" aria-label="Print this book">
                            <i id="print-button" class="fa fa-print"></i>
                        </a>
                    </div>
                </div>

                <div id="search-wrapper" class="hidden">
                    <form id="searchbar-outer" class="searchbar-outer">
                        <input type="search" id="searchbar" name="searchbar" placeholder="Search this book ..." aria-controls="searchresults-outer" aria-describedby="searchresults-header">
                    </form>
                    <div id="searchresults-outer" class="searchresults-outer hidden">
                        <div id="searchresults-header" class="searchresults-header"></div>
                        <ul id="searchresults">
                        </ul>
                    </div>
                </div>
                <!-- Apply ARIA attributes after the sidebar and the sidebar toggle button are added to the DOM -->
                <script type="text/javascript">
                    document.getElementById('sidebar-toggle').setAttribute('aria-expanded', sidebar === 'visible');
                    document.getElementById('sidebar').setAttribute('aria-hidden', sidebar !== 'visible');
                    Array.from(document.querySelectorAll('#sidebar a')).forEach(function(link) {
                        link.setAttribute('tabIndex', sidebar === 'visible' ? 0 : -1);
                    });
                </script>

                <div id="content" class="content">
                    <main>
                        <h1 id="introduction"><a class="header" href="#introduction">Introduction</a></h1>
<p>This is an introduction chapter which briefly explains the layout of this book.
This book contains two points of focus.</p>
<h2 id="part-one"><a class="header" href="#part-one">Part one</a></h2>
<p>This part should give an extensive description of the project, describe all of
its features and how the project should look like, in its final state. It
should describe the project from the <strong>user's</strong> perspective, to give a clear
understanding of the goal of this project. It is important to read this part if
you want to work on the project and understand where the project is going.</p>
<h2 id="part-two"><a class="header" href="#part-two">Part two</a></h2>
<p>This part should give a clear understanding of the project's architecture. It
should describe the project from the <strong>developer's</strong> perspective, and should
help developers understand how the project works under the hood.</p>
<h2 id="layout"><a class="header" href="#layout">Layout</a></h2>
<p>In part two, every component of the project is split under multiple
subchapters. Each component should have a main chapter which includes its
description, describing what it is, what it is used for, etc. Components
containing an API should have an API subchapter, describing all of its
endpoints, the expected data, and the return data.</p>
<div id="admonition-wip" class="admonition warning">
<div class="admonition-title">
<a class="admonition-anchor-link" href="introduction.html#admonition-wip">
<p><strong>WIP</strong></p>
</a>
</div>
<div>
<p>Work in progress parts are marked like this. This paragraph should include a
link to the corresponding GitHub issue (if there is one), and give a brief
understanding of the feature's development status. As this is the start of the
project, no part is marked as WIP, and they are all assumed to be WIP.</p>
</div>
</div>
<div style="break-before: page; page-break-before: always;"></div><h1 id="description"><a class="header" href="#description">Description</a></h1>
<p>This part of the book focuses on documenting the project's features.</p>
<h2 id="brief-description"><a class="header" href="#brief-description">Brief description</a></h2>
<p>CRBl_ Studio Games is an open source, collaborative and extensible mini-games
server and web interface. It's supposed to be a place of joy and fun built for
friends, built by friends with joy and fun.</p>
<p>The main feature of the project is playing games, composed of configurable
rounds. Each round is a mini-game. Mini-games are short, 1-2 minutes games,
which return an amount of points at the end. At the end of the game, each
player's score is composed of the sum of all the scores he did during each
round. The player with the highest score wins.</p>
<h2 id="user-experience"><a class="header" href="#user-experience">User experience</a></h2>
<p>Here is a graphical representation of how the user should interact with the
website. For more details, read the extended description below.</p>
<pre class="mermaid">flowchart TD
    enter[User enters the website]
    login[The users logs in]
    register[The user creates an account]
    home[The user is on the home page]
    join[The user joins a room]
    host[The user creates a room]
    lobby[Users are waiting in the lobby]
    configure[The host configures the game]
    start[The host starts the party]
    game[The game unfolds, round by round]
    theend[The game ends]
    enter --&gt; login
    enter --&gt; register
    login --&gt; home
    register --&gt; home
    home --&gt; host
    home --&gt; join
    host --&gt; lobby
    join --&gt; lobby
    configure --&gt; start
    lobby --&gt; configure
    start --&gt; game
    game --&gt; theend
    theend --&gt; lobby
</pre>
<h3 id="joining-the-website"><a class="header" href="#joining-the-website">Joining the website</a></h3>
<p>The first thing the user do is joining the website. On the landing page, the
users has the choice between registering or logging in, as well as a nice
preview of what the project is. Registering is as simple as providing a
username, an email address and a password. After verifying his email, the user
can connect to the website and start using it.</p>
<h3 id="room-and-lobby"><a class="header" href="#room-and-lobby">Room and lobby</a></h3>
<p>Once the player has an account, he's ready to start playing. Creating a room is
as simple as clicking a button. This will redirect the player to a room, and
create a shareable link to the room he can share with friends, or directly
invite friends from his friends list. While waiting for everyone to join and
get ready, the host (the person who created the room) will be able to configure
the lobby (or select some predefined game configurations). During this
phase, the host can add rounds, select what mini-game to play each round, and
configure some mini-games details.</p>
<h3 id="game-phase"><a class="header" href="#game-phase">Game phase</a></h3>
<p>During the game phase, the players are focused on the game. They can
communicate through an in game chat, but it would be preferable for them to be
in a call. Each round will get played one after the other, with small pauses in
between. An ability to vote for a pause will allow players to pause the game in
case an emergency intervenes.</p>
<h3 id="game-end"><a class="header" href="#game-end">Game end</a></h3>
<p>At the end of the game, there is a recap of each round and a leader board
displaying who won, and some fun statistics about each player. Afterwards, the
players are dropped back in the lobby, where the cycle begins once again.</p>
<h2 id="extensions"><a class="header" href="#extensions">Extensions</a></h2>
<div id="admonition-info" class="admonition info">
<div class="admonition-title">
<a class="admonition-anchor-link" href="description.html#admonition-info">
<p>Info</p>
</a>
</div>
<div>
<p>This part is subject to change, and some extensions below might get their
dedicated chapters in the future, if they get into development.</p>
</div>
</div>
<p>Here is a list of extensions ideas. These are just ideas, but it would be great
to plan the project in a way to leave room for easy implementation of these :</p>
<ul>
<li>Friend list, with easy messaging and invites</li>
<li>Mini-games marketplace</li>
<li>Mumble plugin</li>
<li>Global leader boards, with high scores</li>
<li>Achievements</li>
</ul>
<div style="break-before: page; page-break-before: always;"></div><h1 id="general-architecture"><a class="header" href="#general-architecture">General architecture</a></h1>
<p>Here is a diagram explaining the general architecture of the project. The blue
part represents communications with authenticated users. The green part
represents the area where a game is played. For more details, continue reading
the paragraphs below.</p>
<pre class="mermaid">sequenceDiagram
    participant U as User
    participant GS as Game Server
    participant MGS as Mini Game Server
    participant Api as API
    participant Auth as Authentication Service
    U-&gt;&gt;Auth: credentials
    Auth-&gt;&gt;U: auth certification
    MGS-&gt;&gt;GS: registers with api key
    GS-&gt;&gt; Auth: checks api key
    rect rgb(9, 66, 163)
        note left of Auth: authenticated user
        U-&gt;&gt;Api: create room request
        Api-&gt;&gt;U: room id
        U-&gt;&gt;GS: joins
        U-&gt;&gt;GS: configure room
        GS-&gt;&gt;Auth: verify user
        rect rgb(14, 107, 7)
            note left of MGS: play game
            U-&gt;&gt;GS: game data
            GS-&gt;&gt;MGS: game data
            note over GS,MGS: communication through secure api
            MGS-&gt;&gt;GS: game data
            GS-&gt;&gt;U: game data
        end
        GS-&gt;&gt;Api: results
        U-&gt;&gt;Api: check results, stats, etc.
    end
</pre>
<h2 id="modules-in-depth-description"><a class="header" href="#modules-in-depth-description">Modules in-depth description</a></h2>
<h3 id="authentication-service"><a class="header" href="#authentication-service">Authentication service</a></h3>
<p>The authentication service does exactly what its name tells you, nothing more.
It is a key point to the project's security. It allows the user to
authenticate, and then prove his identity to the API service and the game
server.</p>
<div id="admonition-info" class="admonition info">
<div class="admonition-title">
<a class="admonition-anchor-link" href="architecture.html#admonition-info">
<p>Info</p>
</a>
</div>
<div>
<p>OAuth 2.0 implementation would allow other external services like mini-games
servers to access user information in order to extend their functionality.</p>
</div>
</div>
<h3 id="api-service"><a class="header" href="#api-service">API service</a></h3>
<p>The API service manages general user data, like friends, game history, high
scores, added mini-games, etc. and it is also responsible for room creation. It
relies on the authentication service to identify the user.</p>
<h3 id="game-server"><a class="header" href="#game-server">Game server</a></h3>
<p>The game server is a real time socket server which communicates with the
different clients during the game. It is responsible for handling the main game
flow, and making contact between the mini-game server and the client. It is a
trusted, first party component. It also relies on the authentication service to
identify users. It interacts with the API service to create rooms, save scores,
etc.</p>
<h3 id="mini-games-servers"><a class="header" href="#mini-games-servers">Mini-games servers</a></h3>
<p>A mini-game server is a real time socket server that implements a mini-game. It
can either be a first party server, or a third party, self-hosted server. To
ensure security, communication between this and the client is done through the
game server, using a secure and well-defined API.</p>
<h3 id="client"><a class="header" href="#client">Client</a></h3>
<p>The client used by the user to play games is a website. The website uses the
authentication service to get access to a token which will identify itself to
other services. It mainly interacts with the API service for viewing and
updating personal data, or creating a room. It communicates with the game
server during the game to send user actions and receive game information.</p>
<h2 id="reasoning"><a class="header" href="#reasoning">Reasoning</a></h2>
<p>First of all, we need to establish the goals we are trying to achieve :</p>
<ul>
<li>Ease of implementation</li>
<li>Modularity (for plug in mini games)</li>
<li>Security (mini games should not be able to be a point of attack, no matter what)</li>
<li>Functionality (mini games should not be limited in any way, or at least to be the least limited possible)</li>
</ul>
<p>Ease of implementation is obvious, do not make it hard if it does not have to
be. Modularity is a must as well : mini-games should be able to be added,
removed, updated without need to touch the project's code. They should be able
to run on other servers, even community servers (self hosted). This means
security has to be very well thought out, since some people might try to create
malicious mini-game servers. The implementation should also not limit the
functionality of mini-games.</p>
<p>This implementation allows for a very great combination of all of the above.
Modularity is respected. Mini-game servers are run on any machine,
authenticated through the authentication service, and plugged in to the game
server. The IP's of the mini-game servers should be stored in a database, and
the authentication service should provide them with API keys, which they will
use to authenticate themselves to other services. This also allows the
mini-game servers to be implemented in any language, leaving the door open to
all developers.</p>
<p>Security is implemented through the game server &lt;-&gt; mini-game server API. The
latter is not yet defined, but it's structure will only allow it to do basic,
game related actions, and not access user data or any other kind of sensitive
endpoint/data.</p>
<p>Functionality is defined through the API as well. That's why it has to be as
open and extensible as possible, while remaining secure.</p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="authentication-service-1"><a class="header" href="#authentication-service-1">Authentication service</a></h1>
<p>The authentication service (or auth service) is a core component which handles
authentication in the entire project. It's a REST API which means there is an
<a href="auth/./auth/api.html">API subchapter</a> which documents all the API endpoints.</p>
<p>This API handles user authentication, first-party components authentication as
well as mini-game servers authentication. Each type of client will get a
different type of authentication proof, which will allow them to identify
themselves to other services. The other services <strong>do not</strong> need to call the
auth service to check if the proof is valid. On authentication, the client will
receive a public key which allows them to verify all authentication proof. This
implementation has its ups and downs. The main advantage is that the auth
service usage is reduced (because the proofs do not have to be checked every
time by a request to the auth service). The main disadvantage is that
invalidating a proof might be tricky, and some elegant solution is yet to be
determined.</p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="database-layout"><a class="header" href="#database-layout">Database layout</a></h1>
<p>Here is a preview of the database layout for the database.</p>
<h2 id="users"><a class="header" href="#users"><code>users</code></a></h2>
<p>A table where the users are stored.</p>
<table><thead><tr><th>Name</th><th>Type</th><th>Unique</th><th>Not null</th><th>Description</th><th>Relation</th></tr></thead><tbody>
<tr><td><code>id</code></td><td><code>number</code></td><td>yes</td><td>yes</td><td>The ID of the user.</td><td></td></tr>
<tr><td><code>name</code></td><td><code>string</code></td><td>yes</td><td>yes</td><td>The unique name of the user.</td><td></td></tr>
<tr><td><code>email</code></td><td><code>string</code></td><td>yes</td><td>yes</td><td>The unique email of the user.</td><td></td></tr>
<tr><td><code>password_hash</code></td><td><code>string</code></td><td>no</td><td>yes</td><td>The hash of the user's password.</td><td></td></tr>
</tbody></table>
<h2 id="user_blacklist"><a class="header" href="#user_blacklist"><code>user_blacklist</code></a></h2>
<p>A table where the blacklisted tokens are stored.</p>
<p>Entries must be removed after the expiration date has been reached.</p>
<table><thead><tr><th>Name</th><th>Type</th><th>Unique</th><th>Not null</th><th>Description</th><th>Relation</th></tr></thead><tbody>
<tr><td><code>token</code></td><td><code>string</code></td><td>yes</td><td>yes</td><td>The token to blacklist.</td><td></td></tr>
<tr><td><code>type</code></td><td><code>number</code></td><td>no</td><td>yes</td><td>The type of token (0 for<code>refresh</code> and 1 for <code>jwt</code>).</td><td></td></tr>
<tr><td><code>expiration</code></td><td><code>date</code></td><td>no</td><td>yes</td><td>The date when the token expires.</td><td></td></tr>
</tbody></table>
<h2 id="projects"><a class="header" href="#projects"><code>projects</code></a></h2>
<p>A table storing projects (mini-games).</p>
<table><thead><tr><th>Name</th><th>Type</th><th>Unique</th><th>Not null</th><th>Description</th><th>Relation</th></tr></thead><tbody>
<tr><td><code>id</code></td><td><code>number</code></td><td>yes</td><td>yes</td><td>The ID of the project.</td><td></td></tr>
<tr><td><code>name</code></td><td><code>string</code></td><td>no</td><td>yes</td><td>The name of the project.</td><td></td></tr>
<tr><td><code>api_key</code></td><td><code>string</code></td><td>yes</td><td>yes</td><td>A key to authenticate the project.</td><td></td></tr>
<tr><td><code>user_id</code></td><td><code>number</code></td><td>no</td><td>yes</td><td>The ID of the user owning the project.</td><td><code>users</code> on <code>id</code></td></tr>
</tbody></table>
<h2 id="temp_users"><a class="header" href="#temp_users"><code>temp_users</code></a></h2>
<p>A table where the just created accounts are stored until their email is
verified. On email verification, users must get transferred from this table to
the <code>users</code> table.</p>
<div id="admonition-note" class="admonition note">
<div class="admonition-title">
<a class="admonition-anchor-link" href="auth/database.html#admonition-note">
<p>Note</p>
</a>
</div>
<div>
<p>When an email is updated, there is no temporary account created. When an email
is changed, the user gets an email with a token that contains an encoded
message that is signed by this server. To update the email, the user clicks on
a link which sends a request to this server and updates the email directly in
the <code>users</code> table.</p>
</div>
</div>
<table><thead><tr><th>Name</th><th>Type</th><th>Unique</th><th>Not null</th><th>Description</th><th>Relation</th></tr></thead><tbody>
<tr><td><code>id</code></td><td><code>number</code></td><td>yes</td><td>yes</td><td>The ID of the user.</td><td></td></tr>
<tr><td><code>name</code></td><td><code>string</code></td><td>yes</td><td>yes</td><td>The unique name of the user.</td><td></td></tr>
<tr><td><code>email</code></td><td><code>string</code></td><td>yes</td><td>yes</td><td>The unique email of the user.</td><td></td></tr>
<tr><td><code>password_hash</code></td><td><code>string</code></td><td>no</td><td>yes</td><td>The hash of the user's password.</td><td></td></tr>
</tbody></table>
<div style="break-before: page; page-break-before: always;"></div><h1 id="introduction-1"><a class="header" href="#introduction-1">Introduction</a></h1>
<p>Foremost, each response is structured as follows :</p>
<pre><code class="language-typescript">interface Dto&lt;T&gt; {
    data: T | null;
    error?: Error | null;
}

interface Error {
    code: number;
    message: string;
}
</code></pre>
<p>Either <code>data</code> or <code>error</code> must be null, and the other one must contain
something. In the rest of this page, we will only declare the interface that
represents <code>T</code>, and list error codes that can be returned by each route.</p>
<p>Errors are only returned if the data is well sent by the client. If data is
malformed, fields are missing, authorization is required, etc., then the HTTP
response code should be between 400 and 499 and the return body should be
empty.</p>
<p>Error codes are route dependent. This means that error code <code>1</code> on <code>POST</code> to
<code>/user</code> does not mean the same thing as error code <code>1</code> on <code>GET</code> to
<code>/server/login</code>.</p>
<p>For input data, the <code>Body</code> interface is considered to be a JSON body, and
the <code>Url</code> interface are the parameters passed in the URL. They should match
the braces in the title of the route. For example, if a route is <code>/user/{id}</code>,
then the <code>Url</code> object should contain one item, named <code>id</code>.</p>
<p>Error code <code>0</code> always means unknown error.</p>
<p>A JWT should contain the following information :</p>
<ul>
<li>an expiration date</li>
<li>a unique identifier to the authenticated entity</li>
<li>an entity type (<code>'User' | 'MiniGameServer'</code>)</li>
</ul>
<h1 id="routes"><a class="header" href="#routes">Routes</a></h1>
<h2 id="post-to-user"><a class="header" href="#post-to-user"><code>POST</code> to <code>/user</code></a></h2>
<p>Creates a new user. Will first stock the user as a <em>temporary</em> user, until
email verification is complete. If the email is not verified within 5 days, the
account will be deleted.</p>
<h3 id="input"><a class="header" href="#input">Input</a></h3>
<h4 id="data"><a class="header" href="#data">Data</a></h4>
<pre><code class="language-typescript">interface Body {
    name: string;     /* The user's display name, must be unique. */
    email: string;    /* The user's email, must be unique. */
    password: string; /* The user's password. */
}
</code></pre>
<h3 id="output"><a class="header" href="#output">Output</a></h3>
<h4 id="error-codes"><a class="header" href="#error-codes">Error codes</a></h4>
<ul>
<li><code>1</code> : name is already used.</li>
<li><code>2</code> : email is already used.</li>
<li><code>3</code> : password is considered insecure.</li>
<li><code>4</code> : name contains invalid characters.</li>
</ul>
<h4 id="http-codes"><a class="header" href="#http-codes">HTTP codes</a></h4>
<ul>
<li><code>400</code> : if the input is malformed (missing fields, unknown fields, etc.).</li>
</ul>
<h2 id="put-to-username"><a class="header" href="#put-to-username"><code>PUT</code> to <code>/user/name</code></a></h2>
<p>Edits a user's name.</p>
<h3 id="input-1"><a class="header" href="#input-1">Input</a></h3>
<h4 id="data-1"><a class="header" href="#data-1">Data</a></h4>
<pre><code class="language-typescript">interface Body {
    name: string; /* The user's new requested name. */
}
</code></pre>
<h4 id="headers"><a class="header" href="#headers">Headers</a></h4>
<ul>
<li><code>Authorization: Bearer &lt;token&gt;</code></li>
</ul>
<h3 id="output-1"><a class="header" href="#output-1">Output</a></h3>
<h4 id="error-codes-1"><a class="header" href="#error-codes-1">Error codes</a></h4>
<ul>
<li><code>1</code> : name is already used.</li>
<li><code>2</code> : name contains invalid characters.</li>
</ul>
<h4 id="http-codes-1"><a class="header" href="#http-codes-1">HTTP codes</a></h4>
<ul>
<li><code>400</code> : if the input is malformed (missing fields, unknown fields, etc.).</li>
<li><code>401</code> : if no authorization token was provided or if the authorization token is invalid.</li>
</ul>
<h2 id="put-to-useremail"><a class="header" href="#put-to-useremail"><code>PUT</code> to <code>/user/email</code></a></h2>
<p>Edits a user's email.</p>
<p>This should not instantly change the user's email, but wait for the user to
verify his new email before changing it. Should send an email to the old email,
to confirm the authenticity of the request, and then send an email to the new
email, to confirm the ownership of the new email address.</p>
<p>The links sent to the email addresses should both be valid for a period of 5
days, and then expire.</p>
<p>The email change should only happen once both links are clicked.</p>
<h3 id="input-2"><a class="header" href="#input-2">Input</a></h3>
<h4 id="data-2"><a class="header" href="#data-2">Data</a></h4>
<pre><code class="language-typescript">interface Body {
    email: string; /* The new requested email. */
}
</code></pre>
<h4 id="headers-1"><a class="header" href="#headers-1">Headers</a></h4>
<ul>
<li><code>Authorization: Bearer &lt;token&gt;</code></li>
</ul>
<h3 id="output-2"><a class="header" href="#output-2">Output</a></h3>
<h4 id="error-codes-2"><a class="header" href="#error-codes-2">Error codes</a></h4>
<ul>
<li><code>1</code> : email is already used.</li>
</ul>
<h4 id="http-codes-2"><a class="header" href="#http-codes-2">HTTP codes</a></h4>
<ul>
<li><code>400</code> : if the input is malformed (missing fields, unknown fields, etc.).</li>
<li><code>401</code> : if no authorization token was provided or if the authorization token is invalid.</li>
</ul>
<h2 id="post-to-useremail"><a class="header" href="#post-to-useremail"><code>POST</code> to <code>/user/email</code></a></h2>
<p>Route to confirm the user's email</p>
<h3 id="input-3"><a class="header" href="#input-3">Input</a></h3>
<h4 id="data-3"><a class="header" href="#data-3">Data</a></h4>
<pre><code class="language-typescript">interface Body {
    token: string; /* Signed email confirmation token. */
}
</code></pre>
<h3 id="output-3"><a class="header" href="#output-3">Output</a></h3>
<h4 id="http-codes-3"><a class="header" href="#http-codes-3">HTTP codes</a></h4>
<ul>
<li><code>400</code> : if the input is malformed (missing fields, unknown fields, etc.).</li>
</ul>
<h2 id="post-to-userlogin"><a class="header" href="#post-to-userlogin"><code>POST</code> to <code>/user/login</code></a></h2>
<p>Logs in a user with his name or email, and password.</p>
<h3 id="input-4"><a class="header" href="#input-4">Input</a></h3>
<h4 id="data-4"><a class="header" href="#data-4">Data</a></h4>
<pre><code class="language-typescript">interface Body {
    email: string | null;
    name: string | null;
    password: string;
}
</code></pre>
<h3 id="output-4"><a class="header" href="#output-4">Output</a></h3>
<h4 id="data-5"><a class="header" href="#data-5">Data</a></h4>
<pre><code class="language-typescript">interface Output {
    jwt: string;          /* A token used to identify the user to other
                           * services. Short lived (10 minutes).
                           */
    refreshToken: string; /* A token used to get a new JWT without needing
                           * to reauthenticate. Long lived (TBD).
                           */
}
</code></pre>
<h4 id="error-codes-3"><a class="header" href="#error-codes-3">Error codes</a></h4>
<ul>
<li><code>1</code> : both email and name are null.</li>
<li><code>2</code> : both email and name are provided.</li>
<li><code>3</code> : no user found with this combination.</li>
</ul>
<h2 id="post-to-userrefresh"><a class="header" href="#post-to-userrefresh"><code>POST</code> to <code>/user/refresh</code></a></h2>
<p>Refreshes a user's token.</p>
<h3 id="input-5"><a class="header" href="#input-5">Input</a></h3>
<h4 id="headers-2"><a class="header" href="#headers-2">Headers</a></h4>
<ul>
<li><code>X-Refresh-Token: &lt;token&gt;</code></li>
</ul>
<h3 id="output-5"><a class="header" href="#output-5">Output</a></h3>
<h4 id="data-6"><a class="header" href="#data-6">Data</a></h4>
<pre><code class="language-typescript">interface Output {
    jwt: string;          /* The newly generated JWT. */
    refreshToken: string; /* A new refreshed refresh token. */
}
</code></pre>
<h4 id="http-codes-4"><a class="header" href="#http-codes-4">HTTP codes</a></h4>
<ul>
<li><code>401</code> if no refresh token was provided or if the refresh token is invalid.</li>
</ul>
<h2 id="post-to-userlogout"><a class="header" href="#post-to-userlogout"><code>POST</code> to <code>/user/logout</code></a></h2>
<p>Logs out a user.</p>
<p>Should invalidate the tokens.</p>
<h3 id="input-6"><a class="header" href="#input-6">Input</a></h3>
<h4 id="headers-3"><a class="header" href="#headers-3">Headers</a></h4>
<ul>
<li><code>Authorization: Bearer &lt;token&gt;</code></li>
<li><code>X-Refresh-Token: &lt;token&gt;</code></li>
</ul>
<h3 id="output-6"><a class="header" href="#output-6">Output</a></h3>
<p>None.</p>
<h2 id="delete-to-user"><a class="header" href="#delete-to-user"><code>DELETE</code> to <code>/user</code></a></h2>
<p>Deletes a user.</p>
<h3 id="input-7"><a class="header" href="#input-7">Input</a></h3>
<h4 id="headers-4"><a class="header" href="#headers-4">Headers</a></h4>
<ul>
<li><code>Authorization: Bearer &lt;token&gt;</code></li>
</ul>
<h3 id="output-7"><a class="header" href="#output-7">Output</a></h3>
<h4 id="http-codes-5"><a class="header" href="#http-codes-5">HTTP codes</a></h4>
<ul>
<li><code>401</code> if no authorization token was provided or if the authorization token is invalid.</li>
</ul>
<h2 id="post-to-mini-game"><a class="header" href="#post-to-mini-game"><code>POST</code> to <code>/mini-game</code></a></h2>
<p>Creates a new mini-game project for the logged-in user.</p>
<h3 id="input-8"><a class="header" href="#input-8">Input</a></h3>
<h4 id="data-7"><a class="header" href="#data-7">Data</a></h4>
<pre><code class="language-typescript">interface Body {
    name: string; /* The name of the project. This name will be used
                   * to display the project in the user's project list
                   * but is not the public display name of the project.
                   * This is unique to the user's level (i.e. the user
                   * cannot have two projects with the same name, but
                   * two projects with the same name can exist).
                   */
}
</code></pre>
<h4 id="headers-5"><a class="header" href="#headers-5">Headers</a></h4>
<ul>
<li><code>Authorization: Bearer &lt;token&gt;</code></li>
</ul>
<h3 id="output-8"><a class="header" href="#output-8">Output</a></h3>
<h4 id="data-8"><a class="header" href="#data-8">Data</a></h4>
<pre><code class="language-typescript">interface Output {
    id: string;     /* Unique mini-game identifier. */
    name: string;   /* The name of the project. */
    apiKey: string; /* Only delivered once as it is stored as a hash in the
                     * database, watch out ! Can be regenerated through a
                     * request. */
}
</code></pre>
<h4 id="error-codes-4"><a class="header" href="#error-codes-4">Error codes</a></h4>
<ul>
<li><code>1</code> : the name is already used.</li>
<li><code>2</code> : the user has reached the maximum number of mini-games allowed per user.</li>
</ul>
<h4 id="http-codes-6"><a class="header" href="#http-codes-6">HTTP codes</a></h4>
<ul>
<li><code>400</code> : if the input is malformed (missing fields, unknown fields, etc.).</li>
<li><code>401</code> : if no authorization token was provided or if the authorization token is invalid.</li>
</ul>
<h2 id="delete-to-mini-gameid"><a class="header" href="#delete-to-mini-gameid"><code>DELETE</code> to <code>/mini-game/{id}</code></a></h2>
<p>Deletes the specified mini-game.</p>
<h3 id="input-9"><a class="header" href="#input-9">Input</a></h3>
<h4 id="headers-6"><a class="header" href="#headers-6">Headers</a></h4>
<ul>
<li><code>Authorization: Bearer &lt;token&gt;</code></li>
</ul>
<h3 id="output-9"><a class="header" href="#output-9">Output</a></h3>
<h4 id="http-codes-7"><a class="header" href="#http-codes-7">HTTP codes</a></h4>
<ul>
<li><code>401</code> : if no authorization token was provided or if the authorization token is invalid.</li>
<li><code>404</code> : if no such mini-game was found or if the mini-game does not belong to the user.</li>
</ul>
<h2 id="post-to-mini-gamelogin"><a class="header" href="#post-to-mini-gamelogin"><code>POST</code> to <code>/mini-game/login</code></a></h2>
<p>Generates an authentication token for a mini-game.</p>
<h3 id="input-10"><a class="header" href="#input-10">Input</a></h3>
<h4 id="headers-7"><a class="header" href="#headers-7">Headers</a></h4>
<ul>
<li><code>X-Api-Key: &lt;api-key&gt;</code></li>
</ul>
<h3 id="output-10"><a class="header" href="#output-10">Output</a></h3>
<h4 id="data-9"><a class="header" href="#data-9">Data</a></h4>
<pre><code class="language-typescript">interface Output {
    jwt: string;
    refreshToken: string;
}
</code></pre>
<h4 id="http-codes-8"><a class="header" href="#http-codes-8">HTTP codes</a></h4>
<ul>
<li><code>401</code> : if no authorization token was provided or if the authorization token is invalid.</li>
</ul>
<h2 id="post-to-mini-gamerefresh"><a class="header" href="#post-to-mini-gamerefresh"><code>POST</code> to <code>/mini-game/refresh</code></a></h2>
<p>Issue a new token for the mini-game.</p>
<h3 id="input-11"><a class="header" href="#input-11">Input</a></h3>
<h4 id="headers-8"><a class="header" href="#headers-8">Headers</a></h4>
<ul>
<li><code>X-Refresh-Token: &lt;token&gt;</code></li>
</ul>
<h3 id="output-11"><a class="header" href="#output-11">Output</a></h3>
<h4 id="data-10"><a class="header" href="#data-10">Data</a></h4>
<pre><code class="language-typescript">interface Output {
    jwt: string;
    refreshToken: string;
}
</code></pre>
<h4 id="http-codes-9"><a class="header" href="#http-codes-9">HTTP codes</a></h4>
<ul>
<li><code>401</code> if no refresh token was provided or if the refresh token is invalid.</li>
</ul>
<h2 id="post-to-mini-gamelogout"><a class="header" href="#post-to-mini-gamelogout"><code>POST</code> to <code>/mini-game/logout</code></a></h2>
<p>Generates an authentication token for a mini-game.</p>
<h3 id="input-12"><a class="header" href="#input-12">Input</a></h3>
<h4 id="headers-9"><a class="header" href="#headers-9">Headers</a></h4>
<ul>
<li><code>Authorization: Bearer &lt;token&gt;</code></li>
<li><code>X-Refresh-Token: &lt;token&gt;</code></li>
</ul>
<h3 id="output-12"><a class="header" href="#output-12">Output</a></h3>
<p>None.</p>
<h2 id="post-to-decode"><a class="header" href="#post-to-decode"><code>POST</code> to <code>/decode</code></a></h2>
<p>Decodes information encoded into a JWT and verifies its authenticity.</p>
<div id="admonition-authorization" class="admonition warning">
<div class="admonition-title">
<a class="admonition-anchor-link" href="auth/api.html#admonition-authorization">
<p>Authorization</p>
</a>
</div>
<div>
<p>Only authorized services should be able to decode and verify a JWT.</p>
</div>
</div>
<div id="admonition-note" class="admonition note">
<div class="admonition-title">
<a class="admonition-anchor-link" href="auth/api.html#admonition-note">
<p>Note</p>
</a>
</div>
<div>
<p>This information can be cached, in order to not verify the JWT on each request.
For example, when the API server wants to know if the JWT is valid, it will
make a request to the authentication server, which will respond with the
necessary information, which is then cached by the API server. This way, the
API server won't have to make another request to the authentication server
whenever the entity makes another request with the same JWT.</p>
</div>
</div>
<div id="admonition-note-1" class="admonition note">
<div class="admonition-title">
<a class="admonition-anchor-link" href="auth/api.html#admonition-note-1">
<p>Note</p>
</a>
</div>
<div>
<p>Data could be decoded locally using a public key, but that implementation would
make it difficult to invalidate tokens. This is why the service wanting to
verify the token asks the authentication service if the token is valid or not.</p>
</div>
</div>
<h3 id="input-13"><a class="header" href="#input-13">Input</a></h3>
<h4 id="data-11"><a class="header" href="#data-11">Data</a></h4>
<pre><code class="language-typescript">interface Body {
    jwt: string;
}
</code></pre>
<h4 id="headers-10"><a class="header" href="#headers-10">Headers</a></h4>
<ul>
<li><code>Authorization: Bearer &lt;token&gt;</code></li>
</ul>
<h3 id="output-13"><a class="header" href="#output-13">Output</a></h3>
<h4 id="data-12"><a class="header" href="#data-12">Data</a></h4>
<pre><code class="language-typescript">interface Output {
    type: 'User' | 'MiniGameServer'; /* The type of the entity identified by the JWT. */
    exp: number;                     /* The date the JWT expires on. */
    id: string;                      /* Unique identifier to the entity. */
}
</code></pre>
<h4 id="error-codes-5"><a class="header" href="#error-codes-5">Error codes</a></h4>
<ul>
<li><code>1</code> : the server was not able to decode the JWT.</li>
<li><code>2</code> : the JWT is expired.</li>
</ul>
<h4 id="http-codes-10"><a class="header" href="#http-codes-10">HTTP codes</a></h4>
<ul>
<li><code>400</code> : if the input is malformed (missing fields, unknown fields, etc.).</li>
<li><code>401</code> : if no authorization token was provided or if the authorization token is invalid.</li>
<li><code>403</code> : if the issuer of the request in not authorized to access this endpoint.</li>
</ul>

                    </main>

                    <nav class="nav-wrapper" aria-label="Page navigation">
                        <!-- Mobile navigation buttons -->
                        <div style="clear: both"></div>
                    </nav>
                </div>
            </div>

            <nav class="nav-wide-wrapper" aria-label="Page navigation">
            </nav>

        </div>

        <script type="text/javascript">
            window.playground_copyable = true;
        </script>
        <script src="elasticlunr.min.js" type="text/javascript" charset="utf-8"></script>
        <script src="mark.min.js" type="text/javascript" charset="utf-8"></script>
        <script src="searcher.js" type="text/javascript" charset="utf-8"></script>
        <script src="clipboard.min.js" type="text/javascript" charset="utf-8"></script>
        <script src="highlight.js" type="text/javascript" charset="utf-8"></script>
        <script src="book.js" type="text/javascript" charset="utf-8"></script>

        <!-- Custom JS scripts -->
        <script type="text/javascript" src="other/mermaid.min.js"></script>
        <script type="text/javascript" src="other/mermaid-init.js"></script>
        <script type="text/javascript">
        window.addEventListener('load', function() {
            window.setTimeout(window.print, 100);
        });
        </script>
    </body>
</html>
